{"version":3,"sources":["LinkExpandable.js"],"names":["LinkExpandable","elements","props","linkElement","expandableElement","backButton","mobileBackButton","mobile","bind","getAttribute","setAttribute","focus","dispatchEvent","CustomEvent","bubbles","detail","menu","component","document","addEventListener","event","isEscape","key","minimize","contains","activeElement","target","console","log","expand","querySelector","shiftKey","focusLink","ariaExpanded","setTimeout","offset","links","querySelectorAll","Array","from","some","link","i"],"mappings":"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","file":"LinkExpandable.js","sourcesContent":["class LinkExpandable {\n    constructor(elements, props = {}) {\n        this.linkElement = elements.linkElement;\n        this.expandableElement = elements.expandableElement;\n        this.backButton = elements.mobileBackButton;\n        this.mobile = props.mobile;\n        this.bind();\n    }\n\n    expand() {\n        if (this.linkElement.getAttribute('aria-expanded') !== 'true') {\n            this.linkElement.setAttribute('aria-expanded', 'true');\n            this.linkElement.focus();\n            this.linkElement.dispatchEvent(new CustomEvent('expanded', {bubbles: true, detail: {menu: this}}));\n        }\n    }\n\n    minimize() {\n        if (this.linkElement.getAttribute('aria-expanded') !== 'false') {\n            this.linkElement.setAttribute('aria-expanded', 'false');\n            this.linkElement.dispatchEvent(new CustomEvent('minimized', {bubbles: true, detail: {menu: this}}));\n        }\n    }\n\n    bind() {\n        const component = this;\n\n        document.addEventListener('keydown', function (event) {\n            let isEscape = false;\n\n            if (\"key\" in event) {\n                isEscape = (event.key === \"Escape\" || event.key === \"Esc\");\n            }\n            if (isEscape) {\n                component.minimize();\n                //if we were focused on a expandableElement child, move focus back up to the button\n                if (component.expandableElement.contains(document.activeElement)) {\n                    component.linkElement.focus();\n                }\n            }\n        });\n\n        if (this.mobile){\n            component.backButton.addEventListener('click', function(event){\n                component.minimize();\n            });\n        }\n\n        if(!this.mobile){\n            document.addEventListener('click', function(event){\n                if(component.expandableElement.contains(event.target) || component.linkElement.contains(event.target) ){\n                    //event.stopPropagation();\n                } else{\n                    component.minimize();\n                }\n\n            });\n        }\n\n        this.linkElement.addEventListener('keydown', function (event) {\n            console.log('link keydown')\n            if (\"key\" in event) {\n                switch (event.key) {\n                    case 'Enter':\n                        component.expand();\n                        break;\n                    case 'ArrowDown':\n                        component.expand();\n                        component.expandableElement.querySelector(\"a\").focus();\n                        break;\n                    case 'Tab':\n                        if (event.shiftKey){\n                            //We're tabbing back from this menu item, minimize\n                            component.minimize();\n                        }\n                }\n            }\n        });\n\n        this.expandableElement.addEventListener('keydown', function (event) {\n            if (\"key\" in event) {\n                switch (event.key) {\n                    case 'ArrowUp':\n                        component.focusLink(-1)\n                        break;\n                    case 'ArrowDown':\n                        component.focusLink(1)\n                        break;\n                }\n            }\n        });\n\n        //mousedown\n        this.linkElement.addEventListener('click', function (event) {\n            let ariaExpanded = component.linkElement.getAttribute('aria-expanded');\n            ariaExpanded === \"true\" ? component.minimize() : component.expand();\n            //event.stopPropagation();\n        });\n\n        this.expandableElement.addEventListener('focusout', function (event) {\n            setTimeout(function () {\n                if (component.linkElement !== document.activeElement && !component.expandableElement.contains(document.activeElement)) {\n                    component.minimize();\n                }\n            }, 1);\n        });\n    }\n\n    //todo: This won't accommodate non-anchor targets, like buttons or a form.\n    focusLink(offset) {\n        const component = this;\n        let links = this.expandableElement.querySelectorAll('a');\n        Array.from(links).some(function (link, i) {\n            if (link === document.activeElement) {\n                if (links[i + offset]) {\n                    links[i + offset].focus();\n                    return true;\n                } else {\n                    component.linkElement.focus();\n                }\n            }\n        });\n    }\n}"]}